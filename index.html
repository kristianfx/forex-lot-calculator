
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lot Size Calculator — Live (Blue Edition)</title>
<style>
  :root{
    --bg:#070b16;
    --card:#0b1020;
    --text:#e8f1ff;
    --muted:#9db3d9;
    --accent1:#00b3ff;
    --accent2:#003b8e;
    --accentGlow:#37d0ff;
    --warn:#ffcc66;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family: -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:var(--text);
    background: radial-gradient(1200px 600px at 15% 10%, #062248 0%, #071227 45%, #05101e 100%),
                linear-gradient(120deg, #001028 0%, #021331 60%, #00122a 100%);
    min-height:100vh;
  }
  .wrap{
    max-width:1080px; margin:0 auto; padding:32px 16px 64px;
    display:grid; grid-template-columns: 280px 1fr 280px; gap:24px; align-items:start;
  }
  h1{grid-column:1/-1; text-align:center; font-size:42px; margin:6px 0 10px; letter-spacing:.5px;
     background: linear-gradient(90deg, #a7dcff, #2ad0ff, #6eb1ff);
     -webkit-background-clip:text; background-clip:text; color:transparent;
     text-shadow: 0 0 18px rgba(55,208,255,.25);
  }
  .side{
    position:relative; height:520px; display:flex; align-items:center; justify-content:center;
    filter: drop-shadow(0 24px 40px rgba(0,0,0,.5));
  }
  /* Simple SVG “3D” icons */
  .icon{
    width: 220px; height:220px; border-radius:28px;
    background: linear-gradient(145deg, rgba(0,157,255,.35), rgba(0,59,142,.5));
    box-shadow: inset 0 0 35px rgba(0,0,0,.35), 0 18px 40px rgba(0,0,0,.35);
    display:grid; place-items:center; position:relative;
  }
  .icon.calc:before, .icon.calc:after{
    content:""; position:absolute; width:70%; height:12px; border-radius:8px;
    background:linear-gradient(90deg, #7fd6ff, #2fb8ff); top:64px; left:15%;
    box-shadow:0 6px 18px rgba(55,208,255,.3);
  }
  .icon.calc:after{ top:110px; width:50%; left:25%; }
  .icon.coin{ border-radius:50%; }
  .icon.coin:before{
    content:""; position:absolute; inset:14px; border-radius:50%;
    border:6px solid rgba(160,220,255,.6);
    box-shadow: inset 0 0 24px rgba(55,208,255,.45);
  }
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
    border:1px solid rgba(90,150,220,.18);
    border-radius:22px; padding:22px; max-width:520px; margin:0 auto;
    box-shadow: 0 20px 40px rgba(0,0,0,.35);
  }
  label{display:block; margin:12px 0 6px; color:#cfe6ff; font-weight:600}
  input, select{
    width:100%; padding:12px 14px; border-radius:12px; border:1px solid rgba(120,180,255,.22);
    background: #081327; color:var(--text); outline:none; font-size:15px;
    transition: box-shadow .2s, border-color .2s;
  }
  input:focus, select:focus{
    border-color: rgba(55,208,255,.9);
    box-shadow: 0 0 0 4px rgba(55,208,255,.18);
  }
  .row{display:grid; grid-template-columns:1fr 1fr; gap:14px}
  .hint{color:var(--muted); font-size:12px; margin-top:4px}
  .status{font-size:13px; margin-top:6px}
  .ok{color:#6ef7c7} .warn{color:var(--warn)}
  button{
    margin-top:14px; width:100%; padding:14px 16px; font-weight:700; font-size:16px;
    color:white; background: linear-gradient(90deg, var(--accent1), var(--accent2));
    border:none; border-radius:14px; cursor:pointer;
    box-shadow: 0 10px 24px rgba(0,126,255,.35), inset 0 0 0 0 rgba(255,255,255,.15);
    transition: transform .08s ease, box-shadow .2s ease;
  }
  button:hover{ box-shadow: 0 12px 28px rgba(0,126,255,.45), inset 0 0 0 2px rgba(255,255,255,.12); }
  button:active{ transform: translateY(1px); }
  .toggle{display:flex; align-items:center; gap:10px; margin-top:6px}
  .result{margin-top:12px; font-size:15px; line-height:1.5}
  @media (max-width:980px){
    .wrap{grid-template-columns:1fr; gap:16px}
    .side{display:none}
  }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Lot Size Calculator</h1>

    <div class="side"><div class="icon calc" title="calculator"></div></div>

    <div class="card">
      <div class="row">
        <div>
          <label for="balance">Account Balance</label>
          <input type="number" id="balance" placeholder="e.g. 1000" />
        </div>
        <div>
          <label for="acct">Account Currency</label>
          <select id="acct">
            <option>GBP</option><option>USD</option><option>EUR</option><option>JPY</option>
            <option>AUD</option><option>CAD</option><option>NZD</option><option>CHF</option><option>SGD</option><option>ZAR</option>
          </select>
        </div>
      </div>

      <label for="risk">Risk Percentage (%)</label>
      <input type="number" id="risk" placeholder="e.g. 2" />

      <label for="pair">Currency / Crypto / Metal Pair</label>
      <input list="pairs" id="pair" placeholder="Search or pick e.g. GBP/JPY, BTC/USD, XAU/USD" />
      <datalist id="pairs">
        <!-- Majors -->
        <option value="EUR/USD"><option value="GBP/USD"><option value="USD/JPY"><option value="AUD/USD"><option value="USD/CAD"><option value="USD/CHF">
        <!-- Minors -->
        <option value="EUR/GBP"><option value="EUR/JPY"><option value="GBP/JPY"><option value="AUD/JPY"><option value="EUR/AUD"><option value="EUR/CAD"><option value="GBP/AUD"><option value="CAD/JPY"><option value="NZD/USD"><option value="AUD/NZD">
        <!-- Popular exotics -->
        <option value="USD/ZAR"><option value="USD/TRY"><option value="USD/MXN"><option value="USD/SGD"><option value="USD/HKD"><option value="EUR/TRY"><option value="GBP/ZAR"><option value="EUR/SGD">
        <!-- Metals -->
        <option value="XAU/USD"><option value="XAU/GBP"><option value="XAU/EUR"><option value="XAG/USD">
        <!-- Crypto (quoted in USD & USDT where applicable) -->
        <option value="BTC/USD"><option value="ETH/USD"><option value="SOL/USD"><option value="XRP/USD"><option value="ADA/USD"><option value="DOGE/USD">
      </datalist>
      <div class="toggle">
        <input type="checkbox" id="live" checked />
        <label for="live">Enable Live Price Auto‑Fill (15s refresh)</label>
      </div>

      <label for="entry">Entry Price</label>
      <input type="number" step="0.00001" id="entry" placeholder="auto" />
      <div id="status" class="status"></div>

      <div class="row">
        <div>
          <label for="sl">Stop Loss Price</label>
          <input type="number" step="0.00001" id="sl" placeholder="e.g. 1.08300" />
        </div>
        <div>
          <label for="tp">Take Profit (optional)</label>
          <input type="number" step="0.00001" id="tp" placeholder="e.g. 1.09500" />
        </div>
      </div>

      <div id="metalCryptoPipBox" style="display:none">
        <label for="pipValueManual">Pip Value per 1.00 lot (in QUOTE currency)</label>
        <input type="number" step="0.0001" id="pipValueManual" placeholder="Set for crypto/metals if needed" />
        <div class="hint">For FX it’s auto (≈10 in quote ccy or 1000 for JPY-quoted). For XAU/crypto you can set a custom value.</div>
      </div>

      <div class="toggle">
        <input type="checkbox" id="sameCcy" checked />
        <label for="sameCcy">My account currency matches the pair's QUOTE currency</label>
      </div>
      <div id="convBox" style="display:none">
        <label for="conv">Conversion rate (QUOTE → Account)</label>
        <input type="number" step="0.00001" id="conv" placeholder="auto when live; otherwise enter e.g. USD→GBP 0.79" />
        <div class="hint">Used to convert pip value into your account currency.</div>
      </div>

      <button id="calc">Calculate Lot Size</button>

      <div class="result" id="out"></div>
      <div class="hint">FX pip size: 0.0001 (most) or 0.01 (JPY-quoted). Metals/crypto may differ — enter manual pip value if needed.</div>
    </div>

    <div class="side"><div class="icon coin" title="coin"></div></div>
  </div>

<script>
const EXH_KEY = "80da51b144672cfefe3072379eefff36";
let timer=null;

function qs(id){ return document.getElementById(id); }
function now(){ return new Date().toLocaleTimeString(); }

function parsePair(v){
  if(!v) return null;
  v = v.trim().toUpperCase().replace(/\\s+/g,'');
  if(v.includes('/')){ const [b,q]=v.split('/'); return {base:b,quote:q,code:`${b}/${q}`}; }
  if(v.length===6){ return {base:v.slice(0,3), quote:v.slice(3), code:`${v.slice(0,3)}/${v.slice(3)}`}; }
  // metals like XAUUSD typed without slash
  if(v.length===7 && v.startsWith('XAU')){ return {base:'XAU', quote:v.slice(3), code:`XAU/${v.slice(3)}`}; }
  return null;
}

function isJPYQuote(q){ return q==='JPY'; }
function isMetal(base){ return base==='XAU' || base==='XAG' || base==='XPT' || base==='XPD'; }
function isCrypto(base){ return ['BTC','ETH','SOL','XRP','ADA','DOGE','BNB','LTC','DOT'].includes(base); }

function pipSize(base, quote){
  if(isMetal(base)) return 0.1;           // simple default for metals
  if(isCrypto(base)) return 1;            // crypto “pip” is arbitrary; encourage manual override
  return isJPYQuote(quote) ? 0.01 : 0.0001;
}

function showStatus(txt, ok=false){ const el=qs('status'); el.className='status ' + (ok?'ok':'warn'); el.textContent=txt; }

async function fetchRate(from, to){
  try{
    // Use ExchangeRate.host convert endpoint
    const url = `https://api.exchangerate.host/convert?from=${from}&to=${to}&places=10&api_key=${EXH_KEY}`;
    const r = await fetch(url);
    const j = await r.json();
    if(j && j.result){ return Number(j.result); }
  }catch(e){}
  return null;
}

async function updateLive(){
  if(!qs('live').checked) return;
  const p = parsePair(qs('pair').value);
  if(!p){ showStatus('Enter a valid pair like GBP/JPY', false); return; }
  const mid = await fetchRate(p.base, p.quote);
  if(mid){
    // format decimals roughly
    const dec = (p.quote==='JPY' || isMetal(p.base)) ? 3 : 5;
    qs('entry').value = mid.toFixed(dec);
    showStatus(`✅ Price ${p.code} = ${mid.toFixed(dec)} (ExchangeRate.host @ ${now()})`, true);
    // auto conversion if needed
    if(!qs('sameCcy').checked){
      const acct = qs('acct').value;
      const conv = await fetchRate(p.quote, acct);
      if(conv){ qs('conv').value = conv.toFixed(6); }
    }
  }else{
    showStatus('Price not available for this pair right now.', false);
  }
}

function startTimer(){
  if(timer) clearInterval(timer);
  if(qs('live').checked){ timer = setInterval(updateLive, 15000); }
}

qs('pair').addEventListener('input', () => {
  const p = parsePair(qs('pair').value);
  // toggle manual pip for metals/crypto
  const showManual = p && (isMetal(p.base) || isCrypto(p.base));
  qs('metalCryptoPipBox').style.display = showManual ? 'block':'none';
  updateLive(); startTimer();
});

qs('live').addEventListener('change', () => {
  if(!qs('live').checked){ if(timer) clearInterval(timer); showStatus('Manual mode enabled.', false); }
  else{ updateLive(); startTimer(); }
});

qs('sameCcy').addEventListener('change', () => {
  qs('convBox').style.display = qs('sameCcy').checked ? 'none' : 'block';
  if(qs('live').checked) updateLive();
});

qs('calc').addEventListener('click', async () => {
  const bal = Number(qs('balance').value);
  const riskPct = Number(qs('risk').value);
  const entry = Number(qs('entry').value);
  const sl = Number(qs('sl').value);
  const p = parsePair(qs('pair').value);
  const acct = qs('acct').value;
  if(!bal || !riskPct || !entry || !sl || !p){ qs('out').innerHTML = "⚠️ Please fill balance, risk, pair, entry & SL."; return; }

  const psize = pipSize(p.base, p.quote);
  const pips = Math.abs(entry - sl) / psize;

  // Pip value per 1.00 lot (in quote currency) defaults
  let pipValQuote;
  if(isMetal(p.base) || isCrypto(p.base)){
    pipValQuote = Number(qs('pipValueManual').value || 0);
    if(!pipValQuote){ qs('out').innerHTML = "⚠️ Enter pip value per lot for this metal/crypto."; return; }
  }else{
    pipValQuote = isJPYQuote(p.quote) ? 1000 : 10;
  }

  // Convert pip value to account currency if needed
  let pipValAccount = pipValQuote;
  if(!qs('sameCcy').checked){
    let conv = Number(qs('conv').value);
    if(!conv){
      conv = await fetchRate(p.quote, acct) || 0;
      qs('conv').value = conv ? conv.toFixed(6) : '';
    }
    if(!conv){ qs('out').innerHTML = "⚠️ Need conversion rate QUOTE→Account."; return; }
    pipValAccount = pipValQuote * conv;
  }

  const riskAmount = bal * (riskPct/100);
  const lotSize = riskAmount / (pips * pipValAccount);

  const sym = acct==='GBP'?'£':acct==='USD'?'$':acct==='EUR'?'€':acct==='JPY'?'¥':acct==='AUD'?'A$':acct==='CAD'?'C$':acct==='NZD'?'NZ$':acct==='CHF'?'₣':'$';
  let html = `Pair: <b>${p.code}</b><br>` +
             `Stop distance: <b>${pips.toFixed(1)} pips</b> (pip size ${psize})<br>` +
             `Pip value (per 1.00 lot, in account): <b>${pipValAccount.toFixed(4)}</b><br>` +
             `Risking <b>${sym}${riskAmount.toFixed(2)}</b><br>` +
             `Recommended Lot Size: <b>${lotSize.toFixed(2)} lots</b>`;

  // If TP present, show R:R
  const tp = Number(qs('tp').value || 0);
  if(tp){
    const rewardPips = Math.abs(tp - entry) / psize;
    const rr = rewardPips / pips;
    html += `<br>Take‑profit distance: <b>${rewardPips.toFixed(1)} pips</b> → R:R ≈ <b>${rr.toFixed(2)}</b>`;
  }
  qs('out').innerHTML = html;
});

// initial
startTimer();
</script>
</body>
</html>
