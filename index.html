<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FX-Lot-Calculator-LIVE-v3.5</title>
<style>
  :root{
    --bg1:#021b3a; --bg2:#000810; --panel:#0b1020; --ink:#e8f1ff; --muted:#9db3d9;
    --b1:#00b3ff; --b2:#003b8e; --ok:#73f7c6; --warn:#ffcc66; --bad:#ff6b6b;
    --green:#00ff66; --amber:#ffaa00; --red:#ff0033;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:-apple-system, Segoe UI, Roboto, Arial, sans-serif; color:var(--ink);
    background: radial-gradient(1200px 700px at 12% 10%, #09264e 0%, #061737 55%, #031020 100%),
                linear-gradient(180deg,var(--bg1),var(--bg2)); min-height:100vh;
  }
  h1{
    margin:30px 0 10px; text-align:center; font-size:44px;
    background:linear-gradient(90deg,#a7dcff,#37d0ff,#6eb1ff);
    -webkit-background-clip:text; background-clip:text; color:transparent;
    text-shadow:0 0 18px rgba(55,208,255,.25);
  }
  .wrap{max-width:1100px; margin:0 auto; padding:0 16px 48px;
        display:grid; grid-template-columns:260px 1fr 260px; gap:24px; align-items:start;}
  .side{height:520px; display:flex; align-items:center; justify-content:center; filter:drop-shadow(0 24px 40px rgba(0,0,0,.55)); position:relative;}
  .icon{width:220px; height:220px; background:linear-gradient(145deg, rgba(0,157,255,.35), rgba(0,59,142,.5));
        box-shadow: inset 0 0 35px rgba(0,0,0,.35), 0 18px 40px rgba(0,0,0,.35); border-radius:28px; position:relative; z-index:1;}
  .icon.calc:before,.icon.calc:after{content:""; position:absolute; left:15%; width:70%; height:12px; border-radius:999px;
        background:linear-gradient(90deg,#7fd6ff,#2fb8ff); top:64px; box-shadow:0 6px 18px rgba(55,208,255,.38)}
  .icon.calc:after{top:112px; width:50%; left:25%}
  .icon.coin{border-radius:50%}
  .icon.coin:before{content:""; position:absolute; inset:14px; border-radius:50%;
     border:6px solid rgba(160,220,255,.65); box-shadow:inset 0 0 24px rgba(55,208,255,.45)}
  .card{background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02));
        border:1px solid rgba(90,150,220,.2); border-radius:20px; padding:22px; max-width:560px; margin:0 auto;
        box-shadow:0 20px 40px rgba(0,0,0,.38); position:relative;}
  label{display:block; margin:12px 0 6px; color:#cfe6ff; font-weight:600}
  input, select{
    width:100%; padding:12px 14px; background:#0a1528; color:#fff; border:1px solid rgba(120,180,255,.22);
    border-radius:12px; outline:none; font-size:15px; transition:box-shadow .2s,border-color .2s;
    box-shadow: 0 18px 28px -18px rgba(88,140,255,.45), inset 0 0 0 1px rgba(104,160,255,.18);
  }
  input:focus, select:focus{border-color:#37d0ff; box-shadow:0 0 0 4px rgba(55,208,255,.18), 0 18px 28px -18px rgba(88,140,255,.45), inset 0 0 0 1px rgba(104,160,255,.18)}
  .row{display:grid; grid-template-columns:1fr 1fr; gap:14px}
  .status{font-size:13px; margin:6px 0; min-height:18px; text-align:left}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  button{width:100%; padding:14px 16px; border:none; border-radius:14px; color:#fff; cursor:pointer; font-weight:700; font-size:16px;
         background:linear-gradient(90deg,var(--b1),var(--b2)); box-shadow:0 10px 24px rgba(0,126,255,.35)}
  button:hover{box-shadow:0 12px 28px rgba(0,126,255,.45)}
  .input-with-btn{position:relative}
  .retry{position:absolute; right:6px; top:6px; padding:8px 10px; border:none; border-radius:10px;
         background:rgba(0,179,255,.14); color:#bfeaff; font-weight:700; cursor:pointer}
  .retry:hover{background:rgba(0,179,255,.25)}
  .hint{color:var(--muted); font-size:12px; margin-top:4px}
  /* hide legacy badge support but keep element-safe */
  .liveBadge{ display:none; }

  .lastUpdated{font-size:12px; color:#a7b9db; margin-top:4px}
  .fade{animation:fadeIn .45s ease}
  @keyframes fadeIn{from{opacity:.4} to{opacity:1}}
  @media (max-width:980px){.wrap{grid-template-columns:1fr; gap:16px}.side{display:none}}
  .valueCard{margin-top:10px; padding:10px; border-radius:12px; background:rgba(0,0,0,.25); border:1px solid rgba(120,180,255,.2)}

  /* ---- New 4-section control panel ---- */
  .mode-panel{
    margin:12px 0 6px;
    border-radius:14px;
    padding:8px;
    background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02));
    border:1px solid rgba(90,150,220,.2);
    position:relative;
    box-shadow: 0 16px 36px rgba(0,0,0,.35);
  }
  .mode-panel::after{ /* subtle ambient glow */
    content:""; position:absolute; inset:-6px; border-radius:16px; pointer-events:none;
    box-shadow: 0 0 40px rgba(55,208,255,.25);
  }
  .mode-grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    grid-template-rows:1fr 1fr;
    gap:8px;
  }
  .seg{
    height:44px; border-radius:12px; border:1px solid rgba(120,180,255,.22);
    background:#0a1528; color:#9db3d9; font-weight:700; font-size:14px; letter-spacing:.3px;
    transition: all .2s ease; cursor:pointer;
    box-shadow: inset 0 0 0 1px rgba(104,160,255,.1);
  }
  .seg.active{
    color:#fff;
    background:linear-gradient(90deg,var(--b1),var(--b2));
    box-shadow: 0 10px 24px rgba(0,126,255,.35), inset 0 0 0 1px rgba(104,160,255,.25);
    border-color: rgba(120,180,255,.35);
  }
  .seg:hover{filter:brightness(1.06)}

  /* ---- Countdown ring overlay ---- */
  .ring-wrap{
    position:absolute; width:260px; height:260px; display:flex; align-items:center; justify-content:center;
  }
  .ring-svg{
    position:absolute; width:260px; height:260px; transform: rotate(90deg) scaleX(-1); /* CCW */
    filter: drop-shadow(0 0 18px rgba(0,0,0,.35));
  }
  .ring-bg{ stroke: rgba(160,220,255,.15); stroke-width:10; fill:none; }
  .ring-fg{ stroke: var(--green); stroke-width:10; fill:none; stroke-linecap:round; transition: stroke .2s linear; }
  .ring-text{
    position:absolute; text-align:center; font-size:14px; color:#a7b9db; line-height:1.25; pointer-events:none;
  }
  .ring-text .time{ display:block; font-size:24px; color:#e8f1ff; margin-top:6px; text-shadow:0 0 10px rgba(55,208,255,.2); }

</style>
</head>
<body>
  <h1>Forex Lot Size Calculator</h1>
  <div class="wrap">
    <div class="side">
      <div class="icon calc" title="calculator"></div>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <label for="balance">Account Balance</label>
          <input id="balance" type="number" placeholder="e.g. 1000">
        </div>
        <div>
          <label for="acct">Account Currency</label>
          <select id="acct">
            <option>GBP</option><option>USD</option><option>EUR</option><option>JPY</option>
            <option>AUD</option><option>CAD</option><option>NZD</option><option>CHF</option><option>SGD</option><option>ZAR</option>
          </select>
        </div>
      </div>

      <label for="risk">Risk Percentage (%)</label>
      <input id="risk" type="number" placeholder="e.g. 2">

      <label for="pair">Currency / Crypto / Metal Pair</label>
      <input id="pair" list="pairs" placeholder="Type or pick e.g. GBP/JPY, BTC/USD, XAU/USD">
      <datalist id="pairs">
        <option value="EUR/USD"><option value="GBP/USD"><option value="USD/JPY"><option value="AUD/USD"><option value="USD/CAD"><option value="USD/CHF">
        <option value="EUR/GBP"><option value="EUR/JPY"><option value="GBP/JPY"><option value="AUD/JPY"><option value="EUR/AUD"><option value="EUR/CAD"><option value="GBP/AUD"><option value="CAD/JPY"><option value="NZD/USD"><option value="AUD/NZD">
        <option value="USD/ZAR"><option value="USD/TRY"><option value="USD/MXN"><option value="USD/SGD"><option value="USD/HKD"><option value="EUR/TRY"><option value="GBP/ZAR"><option value="EUR/SGD">
        <option value="XAU/USD"><option value="XAG/USD"><option value="XAU/GBP"><option value="XAU/EUR">
        <option value="BTC/USD"><option value="ETH/USD"><option value="SOL/USD"><option value="XRP/USD"><option value="ADA/USD"><option value="DOGE/USD">
      </datalist>

      <!-- Hidden legacy toggle state to keep logic compatible -->
      <input id="live" type="checkbox" checked style="display:none">

      <!-- NEW 4-section control panel (replaces old checkbox section) -->
      <div id="modePanel" class="mode-panel">
        <div class="mode-grid">
          <button class="seg active" data-role="fetch" data-value="live">LIVE FETCH</button>
          <button class="seg" data-role="fetch" data-value="manual">MANUAL FETCH</button>
          <button class="seg active" data-role="refresh" data-value="auto">AUTO REFRESH</button>
          <button class="seg" data-role="refresh" data-value="manual">MANUAL REFRESH</button>
        </div>
      </div>

      <label for="entry">Entry Price</label>
      <div class="input-with-btn">
        <input id="entry" type="number" step="0.00001" placeholder="auto">
        <button id="retry" class="retry" title="Retry live price">ðŸ”„</button>
      </div>
      <div id="status" class="status"></div>
      <div id="lastUpdated" class="lastUpdated"></div>

      <div class="row">
        <div>
          <label for="sl">Stop Loss Price</label>
          <input id="sl" type="number" step="0.00001" placeholder="e.g. 1.08300">
        </div>
        <div>
          <label for="tp">Take Profit (optional)</label>
          <input id="tp" type="number" step="0.00001" placeholder="e.g. 1.09500">
        </div>
      </div>

      <div id="pipManualBox" style="display:none">
        <label for="pipValManual">Pip value per 1.00 lot (in QUOTE currency)</label>
        <input id="pipValManual" type="number" step="0.0001" placeholder="Set for metals/crypto if needed">
        <div class="hint">FX auto: â‰ˆ10 (quote) or 1000 for JPY-quotes. For XAU/crypto provide your broker's pip value.</div>
      </div>

      <div class="toggle" style="display:none">
        <input id="sameCcy" type="checkbox" checked>
        <label for="sameCcy">My account currency matches the pair's QUOTE currency</label>
      </div>
      <div id="convBox" style="display:none">
        <label for="conv">Conversion rate (QUOTE â†’ Account)</label>
        <input id="conv" type="number" step="0.00001" placeholder="auto when live; or enter e.g. USDâ†’GBP 0.79">
        <div class="hint">Converts pip value into your account currency.</div>
      </div>

      <button id="calc">Calculate Lot Size</button>
      <div id="out" class="status" style="text-align:center"></div>

      <div id="valueCard" class="valueCard" style="display:none"></div>
      <div class="hint">FX pip size: 0.0001 (most) or 0.01 (JPY-quoted). Metals/crypto differ â€” enter manual pip value if needed.</div>
    </div>

    <div class="side">
      <div class="icon coin" title="coin"></div>
      <!-- Countdown ring overlay -->
      <div class="ring-wrap" aria-hidden="true">
        <svg class="ring-svg" viewBox="0 0 260 260">
          <circle class="ring-bg" cx="130" cy="130" r="110"></circle>
          <circle id="ringFg" class="ring-fg" cx="130" cy="130" r="110" stroke-dasharray="691" stroke-dashoffset="0"></circle>
        </svg>
        <div class="ring-text">
          <div>Price Refresh in:</div>
          <span id="ringTime" class="time">00:30</span>
        </div>
      </div>
    </div>
  </div>

<script>
const DEBUG = true;
function log(...args){ if(DEBUG) console.log("[FX v3.5]", ...args); }

let timer=null, elapsed=0;
const qs = id => document.getElementById(id);
const status = (t,c='warn') => { const el=qs('status'); el.className='status '+c; el.textContent=t; };
const nowTime = () => new Date().toLocaleTimeString();

// state for new controls
const state = {
  liveFetch: true,
  autoRefresh: true,
  pairedMode: true
};

// â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
// â”‚ Countdown ring + color lerp   â”‚
// â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
const R = 110;
const CIRC = Math.round(2 * Math.PI * R); // ~691
const ring = document.getElementById('ringFg');
const ringTime = document.getElementById('ringTime');

function lerp(a,b,t){ return a + (b-a)*t; }
function mixColor(c1, c2, t){
  // c1,c2 as [r,g,b]; return css rgb()
  const r = Math.round(lerp(c1[0], c2[0], t));
  const g = Math.round(lerp(c1[1], c2[1], t));
  const b = Math.round(lerp(c1[2], c2[2], t));
  return `rgb(${r},${g},${b})`;
}
const GREEN=[0,255,102], AMBER=[255,170,0], RED=[255,0,51];

function setRing(sec){
  // progress from 0..30; we want countdown CCW, so offset grows with sec
  const rem = Math.max(0, 30 - sec);
  ringTime.textContent = `00:${String(rem).padStart(2,'0')}`;

  const progress = sec/30; // 0..1
  // color: first half green->amber, second half amber->red
  let color;
  if(progress < 0.5){
    color = mixColor(GREEN, AMBER, progress/0.5);
  } else {
    color = mixColor(AMBER, RED, (progress-0.5)/0.5);
  }
  ring.style.stroke = color;

  // dashoffset: full circle is CIRC; CCW via transform on SVG, so we use increasing offset
  const offset = Math.min(CIRC, Math.max(0, CIRC * (sec/30)));
  ring.setAttribute('stroke-dasharray', CIRC);
  ring.setAttribute('stroke-dashoffset', offset);
}

// kept for compatibility; now proxies to ring color
function setBadgeColor(sec){
  setRing(sec);
}

// â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
// â”‚ Pair parser and rates         â”‚
// â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
function parsePair(v){
  if(!v) return null;
  v=v.trim().toUpperCase().replace(/\\s+/g,'');
  if(v.includes('/')){ const [b,q]=v.split('/'); return {b,q,code:`${b}/${q}`}; }
  if(v.length===6){ return {b:v.slice(0,3), q:v.slice(3), code:`${v.slice(0,3)}/${v.slice(3)}`}; }
  if(v.startsWith('XAU')||v.startsWith('XAG')){ return {b:v.slice(0,3), q:v.slice(3), code:`${v.slice(0,3)}/${v.slice(3)}`}; }
  return null;
}
function isJPY(q){ return q==='JPY'; }
function isMetal(b){ return b==='XAU'||b==='XAG'||b==='XPT'||b==='XPD'; }
function isCrypto(b){ return ['BTC','ETH','SOL','XRP','ADA','DOGE','BNB','LTC','DOT'].includes(b); }
function pipSize(b,q){ if(isMetal(b)) return 0.1; if(isCrypto(b)) return 1; return isJPY(q)?0.01:0.0001; }

async function erapiRate(base, quote){
  try{
    const r = await fetch(`https://open.er-api.com/v6/latest/${base}`);
    const j = await r.json();
    if(j && j.result === "success" && j.rates && typeof j.rates[quote] === 'number'){
      return j.rates[quote];
    }
  }catch(e){ log("erapi error", e); }
  return null;
}
async function exhRate(base, quote){
  try{
    let r = await fetch(`https://api.exchangerate.host/convert?from=${base}&to=${quote}`);
    let j = await r.json();
    if(j && typeof j.result === 'number' && j.result>0) return j.result;
  }catch(e){ log("exh error", e); }
  return null;
}
async function getRate(base, quote){
  let rate = await erapiRate(base, quote);
  if(rate){ log("rate via erapi", base, quote, rate); return rate; }
  rate = await exhRate(base, quote);
  if(rate){ log("rate via exchangerate.host", base, quote, rate); return rate; }
  log("rate unavailable", base, quote);
  return null;
}

const cache = {}; // pair code -> last good rate

async function updateLive(){
  if(!state.liveFetch) return;
  const p = parsePair(qs('pair').value);
  if(!p){ status('Enter a valid pair like GBP/JPY','bad'); return; }
  status('Fetching live priceâ€¦');
  const rate = await getRate(p.b, p.q);
  if(rate){
    cache[p.code] = rate;
    const dec = (p.q==='JPY'||isMetal(p.b)) ? 3 : 5;
    qs('entry').value = rate.toFixed(dec);
    // reactive pulse
    qs('entry').classList.add('fade'); setTimeout(()=>qs('entry').classList.remove('fade'), 450);
    status(`âœ… ${p.code} = ${rate.toFixed(dec)}  (${nowTime()})`,'ok');
    qs('lastUpdated').textContent = `â± Last Updated: ${nowTime()}`;
    elapsed = 0; setBadgeColor(elapsed);
    if(!qs('sameCcy').checked){
      const conv = await getRate(p.q, qs('acct').value);
      if(conv) qs('conv').value = conv.toFixed(6);
    }
  }else if(cache[p.code]){
    const dec = (p.q==='JPY'||isMetal(p.b)) ? 3 : 5;
    qs('entry').value = cache[p.code].toFixed(dec);
    status(`âš ï¸ Live failed â€” using cached ${p.code} = ${cache[p.code].toFixed(dec)} (${nowTime()})`,'warn');
    qs('lastUpdated').textContent = `â± Last Updated: ${nowTime()} (cached)`;
  }else{
    status('Price not available for this pair right now.','bad');
  }
}

function startTimer(){
  if(timer) clearInterval(timer);
  if(state.autoRefresh && state.liveFetch){
    timer = setInterval(() => {
      elapsed += 1;
      setBadgeColor(elapsed);
      if(elapsed >= 30){
        updateLive();
      }
    }, 1000);
  } else {
    // still update ring visually even if not auto refreshing
    timer = setInterval(() => {
      // in manual modes, keep ring at 30 (no countdown)
      setRing(0);
    }, 1000);
  }
}

// ---- Control panel logic ----
const panel = document.getElementById('modePanel');
panel.addEventListener('click', (ev) => {
  const btn = ev.target.closest('.seg');
  if(!btn) return;
  const role = btn.getAttribute('data-role');
  const val = btn.getAttribute('data-value');

  if(state.pairedMode){
    // first click pairs both rows
    const live = (role === 'fetch') ? (val === 'live')
                : (role === 'refresh') ? (val === 'auto')
                : true;
    state.liveFetch = live;
    state.autoRefresh = live;
    state.pairedMode = false; // future clicks manual
  } else {
    if(role === 'fetch'){
      state.liveFetch = (val === 'live');
    } else if(role === 'refresh'){
      state.autoRefresh = (val === 'auto');
    }
  }
  // reflect hidden legacy checkbox for compatibility
  qs('live').checked = state.liveFetch;

  // update UI classes
  for(const el of panel.querySelectorAll('.seg')) el.classList.remove('active');
  const sel = [
    `[data-role="fetch"][data-value="${state.liveFetch?'live':'manual'}"]`,
    `[data-role="refresh"][data-value="${state.autoRefresh?'auto':'manual'}"]`
  ];
  sel.forEach(s => panel.querySelector(s).classList.add('active'));

  if(!state.autoRefresh || !state.liveFetch){
    status('Manual mode enabled.','warn');
  }
  startTimer();
});

// Original listeners adapted
qs('pair').addEventListener('input', () => {
  const p = parsePair(qs('pair').value);
  const showManual = p && (isMetal(p.b)||isCrypto(p.b));
  qs('pipManualBox').style.display = showManual ? 'block':'none';
  if(state.liveFetch){
    updateLive();
    startTimer();
  }
});
qs('retry').addEventListener('click', () => { elapsed = 29; setBadgeColor(elapsed); updateLive(); });

// Lot size calculation (unchanged)
qs('calc').addEventListener('click', async () => {
  const bal = Number(qs('balance').value);
  const riskPct = Number(qs('risk').value);
  const entry = Number(qs('entry').value);
  const sl = Number(qs('sl').value);
  const p = parsePair(qs('pair').value);
  const acct = qs('acct').value;
  const out = qs('out');
  if(!bal || !riskPct || !entry || !sl || !p){ out.className='status bad'; out.textContent='Please fill balance, risk, pair, entry & SL.'; return; }

  const ps = pipSize(p.b, p.q);
  const pips = Math.abs(entry - sl) / ps;

  let pipValQuote;
  if(isMetal(p.b) || isCrypto(p.b)){
    pipValQuote = Number(qs('pipValManual').value || 0);
    if(!pipValQuote){ out.className='status bad'; out.textContent='Enter pip value per lot for this metal/crypto.'; return; }
  }else{
    pipValQuote = isJPY(p.q) ? 1000 : 10;
  }

  let pipValAccount = pipValQuote;
  if(!qs('sameCcy').checked){
    let conv = Number(qs('conv').value);
    if(!conv){ conv = await getRate(p.q, acct) || 0; qs('conv').value = conv ? conv.toFixed(6) : ''; }
    if(!conv){ out.className='status bad'; out.textContent='Need conversion rate QUOTEâ†’Account.'; return; }
    pipValAccount = pipValQuote * conv;
  }

  const riskAmt = bal * (riskPct/100);
  const lot = riskAmt / (pips * pipValAccount);
  const sym = acct==='GBP'?'Â£':acct==='USD'?'$':acct==='EUR'?'â‚¬':acct==='JPY'?'Â¥':acct==='AUD'?'A$':acct==='CAD'?'C$':acct==='NZD'?'NZ$':acct==='CHF'?'â‚£':'$';
  let html = `Pair <b>${p.code}</b> â€¢ Stop: <b>${pips.toFixed(1)} pips</b> (pip ${ps})<br>` +
             `Pip value (1.00 lot, in account): <b>${pipValAccount.toFixed(4)}</b><br>` +
             `Risking <b>${sym}${riskAmt.toFixed(2)}</b><br>` +
             `Recommended Lot Size: <b>${lot.toFixed(2)} lots</b>`;
  const tp = Number(qs('tp').value||0);
  if(tp){ const rewardPips = Math.abs(tp-entry)/ps; const rr = rewardPips/pips; html += `<br>TP distance: <b>${rewardPips.toFixed(1)} pips</b> â€¢ R:R â‰ˆ <b>${rr.toFixed(2)}</b>`; }
  out.className='status ok'; out.innerHTML = html;

  await showLotValues(p, acct, lot);
});

async function showLotValues(p, acct, lotSize){
  if(!p || !acct){ qs('valueCard').style.display='none'; return; }
  if(isMetal(p.b) || isCrypto(p.b)){ qs('valueCard').style.display='none'; return; }
  const baseToAcct = await getRate(p.b, acct);
  if(!baseToAcct){ qs('valueCard').style.display='none'; return; }
  const perLot = 100000 * baseToAcct;
  const tradeVal = perLot * (Number(lotSize)||0);
  const sym = acct==='GBP'?'Â£':acct==='USD'?'$':acct==='EUR'?'â‚¬':acct==='JPY'?'Â¥':acct==='AUD'?'A$':acct==='CAD'?'C$':acct==='NZD'?'NZ$':acct==='CHF'?'â‚£':'$';
  qs('valueCard').innerHTML = `ðŸ’· 1.00 lot = <b>${sym}${perLot.toLocaleString(undefined,{maximumFractionDigits:0})} ${acct}</b><br>
                        ðŸ’· Your trade size (${(Number(lotSize)||0).toFixed(2)} lots) = <b>${sym}${tradeVal.toLocaleString(undefined,{maximumFractionDigits:0})} ${acct}</b>`;
  qs('valueCard').style.display='block';
}

// init
(function restore(){
  try{
    const s = JSON.parse(localStorage.getItem("fx_v34_state")||"{}");
    if(s.balance) qs('balance').value = s.balance;
    if(s.acct) qs('acct').value = s.acct;
    if(s.risk) qs('risk').value = s.risk;
    if(s.pair) qs('pair').value = s.pair;
  }catch(_){}
  setBadgeColor(0);
  if(qs('pair').value && state.liveFetch) updateLive();
  startTimer();
})();
['balance','acct','risk','pair'].forEach(id => {
  qs(id).addEventListener('change', ()=>{
    const s = {
      balance: qs('balance').value,
      acct: qs('acct').value,
      risk: qs('risk').value,
      pair: qs('pair').value
    };
    localStorage.setItem("fx_v34_state", JSON.stringify(s));
  });
});
</script>
</body>
</html>
